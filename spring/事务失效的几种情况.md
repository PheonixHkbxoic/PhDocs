
[TOC]



## 事务失效的几种情况

事务失效的几种情况。遇到这问题时，可从以下几方面来考虑排查，如下：



### 1.数据库引擎不支持事务

​		mysql的myisam引擎不支持事务操作，innodb才支持事务。

​		从mysql5.5.5开始的默认存储引擎是innodb 之前默认都是myisam



### 2.没有被spring管理

   	因为事务使用的是代理类织入。如@Service注解被注解掉，则该bean不会被spring管理



### 3.方法不是public的

   	@Transactional只能用于public的方法上，否则会失效。若要用在非public的方法上，可以开启AspectJ代理模式



### 4.自调用问题

   调用该类自己的方法，而没有经过spring的代理类，默认只有在外部调用事务才会生效。

​	解决方案之一是在类中注入自己，用注入的对象再调用另外一个方法。

​	另一个方案如下：

   		使用两个服务类(被调用的方法也定义到一个service类里)，从ioc容器中直接获取该服务的代理对象



### 5.数据源没有配置事务管理器



### 6.事务的扩展上不支持事务

   如 Propagation.NOT_SUPPORTED 表示不以事务运行，当前存在事务则挂起



### 7.异常被吃

   将异常try catch 没有throw出来。回滚异常没有，无法回滚



### 8.异常类型错误

   默认回滚的是RuntimeException,如果想触发其他异常回滚，需要在注解上配置一下(rollbackFor=Exception.class)



## 总结

最多发生的就是自身调用，异常被吃 异常抛出类型不对这三类